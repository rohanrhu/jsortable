/*
 * https://github.com/rohanrhu/jsortable
 * Copyright (C) 2015, Oğuzhan Eroğlu <rohanrhu2@gmail.com>
 * Licensed under MIT
 */

!function(c){var t={init:function(e){var g=this,t=c(this);void 0===e&&(e={}),g.parameters=e,g.parameters.mode=void 0!==g.parameters.mode?g.parameters.mode:c.fn.jsortable.MODE_HORIZONTAL,g.parameters.show_source_placeholder=void 0===g.parameters.show_source_placeholder||g.parameters.show_source_placeholder,g.parameters.show_target_placeholder=void 0===g.parameters.show_target_placeholder||g.parameters.show_target_placeholder,t.each(function(){var t=c(this),p={};t.data("jsortable",p),t.remove(".jsortable_placeholder"),t.off(".jsortable"),t.find("*").off(".jsortable"),p.$jsortable_sortable_s=t.find(g.parameters.sortable),p.$jsortable_sortable_s__order=t.find(g.parameters.sortable);var r=c("body");t.on("jsortable_initialize.jsortable",function(e){p.initialize()}),p.initialize=function(){},t.addClass("jsortable");var e=c("<div></div>");e.addClass("__proto"),e.addClass("jsortable_placeholder"),e.css({background:"#f1f1f1",position:"relative"});var a=c("<div></div>");a.addClass("__proto"),a.addClass("sortablePlaceholder_layer1"),a.css({position:"absolute",left:0,top:0,width:"100%",height:"100%",border:"1px dashed rgba(0,0,0,0.2)"});var o=a.clone(!0);o.removeClass("__proto"),p.$jsortable_sortable_s.each(function(){c(this).data("jsortable",{})}),p.updateIndexes=function(){p.$jsortable_sortable_s__order=t.find(g.parameters.sortable);var e=0;p.$jsortable_sortable_s__order.each(function(){c(this).data("jsortable").index=e++})},p.updateIndexes();var s=e.clone(!0),b=e.clone(!0);o.clone(!0).appendTo(s),o.clone(!0).appendTo(b),s.addClass("jsortable_placeholder__source"),b.addClass("jsortable_placeholder__target"),s.removeClass("__proto"),b.removeClass("__proto"),p.$jsortable_sortable_s.each(function(){var a=c(this);a.data("jsortable");o.css({"border-radius":a.css("border-radius")}),p.sortable_state={},p.sortable_state.need_drop=!1,p.sortable_state.drop_to=null,p.sortable_state.to=null,a.on("draginit.jsortable",function(e){p.updateIndexes(),p.sortable_state.need_drop=!1}),a.on("dragstart.jsortable",function(e){a.hasClass("jsortable__dragging")||(s.insertAfter(a),s.width(a.outerWidth()),s.height(a.outerHeight()),s.css({float:a.css("float"),display:a.css("display")}),g.parameters.show_source_placeholder?s.css({"margin-left":a.css("margin-left"),"margin-right":a.css("margin-right"),"margin-top":a.css("margin-top"),"margin-bottom":a.css("margin-bottom")}):s.css({overflow:"hidden"}).width(0).height(0),b.width(a.outerWidth()),b.height(a.outerHeight()),b.css({float:a.css("float"),display:a.css("display")}),g.parameters.show_target_placeholder?b.css({"margin-left":a.css("margin-left"),"margin-right":a.css("margin-right"),"margin-top":a.css("margin-top"),"margin-bottom":a.css("margin-bottom")}):b.css({overflow:"hidden"}).width(0).height(0),a.css({position:"absolute","z-index":9999999,left:e.pageX,top:e.pageY}),a.addClass("jsortable__dragging"),a.appendTo(r))}),a.on("drag.jsortable",function(_){var e=_.pageX-a.outerWidth()/2,t=_.pageY-a.outerHeight()/2;a.css({left:e,top:t});p.$jsortable_sortable_s__order.not(a).each(function(){clearTimeout(0);var e,t,a=c(this),r=a.data("jsortable"),o=a.offset().left,s=o+a.outerWidth(),l=o+a.outerWidth()/2,i=a.offset().top,d=i+a.outerHeight(),n=i+a.outerHeight()/2;if(e=b.offset().left,e+b.outerWidth(),t=b.offset().top,t+b.outerHeight(),p.sortable_state.to&&(p.sortable_state.to.data("jsortable").index,r.index),g.parameters.mode==c.fn.jsortable.MODE_HORIZONTAL){if(_.pageX>o&&_.pageX<l&&_.pageY>i&&_.pageY<d)return b.insertBefore(a),p.sortable_state.need_drop=!0,p.sortable_state.drop_to=b,p.sortable_state.to=a,!1;if(_.pageX>l&&_.pageX<s&&_.pageY>i&&_.pageY<d)return b.insertAfter(a),p.sortable_state.need_drop=!0,p.sortable_state.drop_to=b,p.sortable_state.to=a,!1}else{if(_.pageY>i&&_.pageY<n&&_.pageX>o&&_.pageX<s)return b.insertBefore(a),p.sortable_state.need_drop=!0,p.sortable_state.drop_to=b,p.sortable_state.to=a,!1;if(_.pageY>n&&_.pageY<d&&_.pageX>o&&_.pageX<s)return b.insertAfter(a),p.sortable_state.need_drop=!0,p.sortable_state.drop_to=b,p.sortable_state.to=a,!1}0})}),a.on("dragend.jsortable",function(e){p.sortable_state.need_drop?(0<b.length&&a.insertAfter(b),a.trigger("jsortable_updated")):a.insertAfter(s),a.css({position:"","z-index":"",top:"",left:""}),a.removeClass("jsortable__dragging"),s.remove(),b.remove(),p.updateIndexes(),p.sortable_state.need_drop=!1,p.sortable_state.to=null})}),p.initialize()})},getElements:function(){return c(this).data("jsortable").$jsortable_sortable_s__order}};c.fn.jsortable=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void c.error("Method "+e+" does not exist on jQuery.jsortable"):t.init.apply(this,arguments)},c.fn.jsortable.MODE_HORIZONTAL=1,c.fn.jsortable.MODE_VERTICAL=2}(jQuery);